name: MacOS Installer Release

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Baixar InstallAssistant.pkg
      run: |
        curl -L -o InstallAssistant.pkg "https://swcdn.apple.com/content/downloads/51/28/082-44432-A_4NJSZXK8G5/v10fo5dlwd50fja3qbnhj7z9tp1dx41vq2/InstallAssistant.pkg"

    - name: Extrair arquivo .dmg do InstallAssistant.pkg
      run: |
        # Montar o InstallAssistant.pkg
        hdiutil attach InstallAssistant.pkg

        # Encontrar e copiar o arquivo .dmg extraído
        cp /Volumes/Install\ macOS\ [NomeDaVersao]/Install\ macOS\ [NomeDaVersao].dmg .

        # Desmontar a imagem
        hdiutil detach /Volumes/Install\ macOS\ [NomeDaVersao]

    - name: Criar um Release no GitHub
      uses: actions/create-release@v1
      with:
        tag_name: v1.0.0
        release_name: "Release do macOS [NomeDaVersao]"
        body: "Release contendo o arquivo .dmg do macOS"
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Upload do arquivo .dmg para o Release
      uses: actions/upload-artifact@v2
      with:
        name: Install-macOS-dmg
        path: Install\ macOS\ [NomeDaVersao].dmg

    - name: Limpeza
      run: |
        # Apagar arquivos temporários
        rm -f InstallAssistant.pkg Install\ macOS\ [NomeDaVersao].dmg
